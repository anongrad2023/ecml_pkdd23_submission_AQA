{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"toc_visible":true,"machine_shape":"hm","authorship_tag":"ABX9TyPapwY1BOTT7SpG/YZmjhMb"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"gpuClass":"standard","widgets":{"application/vnd.jupyter.widget-state+json":{"a702fe9e514b4a34849d2ecd86256b02":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_55eb18ed2ea24f62b68d5f9301b23fca","IPY_MODEL_6220c742f61a4aacba6b9e01e76f3386","IPY_MODEL_ed5b2591b62d4684aa4c3dfebde3a45c"],"layout":"IPY_MODEL_c01f136eb82549f0a813fb0ab5ae0621"}},"55eb18ed2ea24f62b68d5f9301b23fca":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_942c719d0b6f4bb28fefc05624ee9b73","placeholder":"​","style":"IPY_MODEL_6bb79bc967974278973b51cd7c52b7a2","value":"Downloading: 100%"}},"6220c742f61a4aacba6b9e01e76f3386":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_49e88acc741a45598cbc81ebfbacfae2","max":760289,"min":0,"orientation":"horizontal","style":"IPY_MODEL_9af8ecc214ff462e9dfe2d057eaf1c0f","value":760289}},"ed5b2591b62d4684aa4c3dfebde3a45c":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_cb77075daea9465288fe5d7d155fa649","placeholder":"​","style":"IPY_MODEL_51026f57142449749ad2ccaebf086c7e","value":" 760k/760k [00:00&lt;00:00, 587kB/s]"}},"c01f136eb82549f0a813fb0ab5ae0621":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"942c719d0b6f4bb28fefc05624ee9b73":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6bb79bc967974278973b51cd7c52b7a2":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"49e88acc741a45598cbc81ebfbacfae2":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9af8ecc214ff462e9dfe2d057eaf1c0f":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"cb77075daea9465288fe5d7d155fa649":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"51026f57142449749ad2ccaebf086c7e":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"bc0deef2403a4b3d80509c2170b87753":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_503b1719d99a48af8ff5b07cad1d3635","IPY_MODEL_e5781b39167e4c1e934866dad70c61d5","IPY_MODEL_1611958956424f35a527697fd0c71220"],"layout":"IPY_MODEL_261e0fd22d6f427ba39f8b487ca7a3c3"}},"503b1719d99a48af8ff5b07cad1d3635":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_738a5288351b4d539ab9c542c0545a27","placeholder":"​","style":"IPY_MODEL_6bcde7793e5745de8fe1932a8e20d1c9","value":"Downloading: 100%"}},"e5781b39167e4c1e934866dad70c61d5":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_77a8fd5be9f94b48a7a593979703448d","max":684,"min":0,"orientation":"horizontal","style":"IPY_MODEL_b2def5eadf284c6799ccd4ee286e0d3b","value":684}},"1611958956424f35a527697fd0c71220":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_c112a76518874d5289f81904945c2cd2","placeholder":"​","style":"IPY_MODEL_46695f2267704473aeff50ba07e196fe","value":" 684/684 [00:00&lt;00:00, 39.0kB/s]"}},"261e0fd22d6f427ba39f8b487ca7a3c3":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"738a5288351b4d539ab9c542c0545a27":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6bcde7793e5745de8fe1932a8e20d1c9":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"77a8fd5be9f94b48a7a593979703448d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b2def5eadf284c6799ccd4ee286e0d3b":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"c112a76518874d5289f81904945c2cd2":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"46695f2267704473aeff50ba07e196fe":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"43dd050aa90d45549132700e255d5962":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_93cc81dd208640ea95a2f8c993561c80","IPY_MODEL_c5d8684bbb454a7597845ca08e6d5a50","IPY_MODEL_8ee21c72ee62400eaa743458f568b51a"],"layout":"IPY_MODEL_ddb6ca56a69342fe9e40efd6fbaab784"}},"93cc81dd208640ea95a2f8c993561c80":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_6c34832ec8d34172aa6236c00d02b255","placeholder":"​","style":"IPY_MODEL_affb6759e2204672a1e0924ade68c094","value":"Downloading: 100%"}},"c5d8684bbb454a7597845ca08e6d5a50":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_b4c57b233b234d12a938d50052b7e831","max":47376696,"min":0,"orientation":"horizontal","style":"IPY_MODEL_c6f20ee4a8334a79832479ffc925ae7c","value":47376696}},"8ee21c72ee62400eaa743458f568b51a":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_db1bd4f563a4441b8a8a51401067469c","placeholder":"​","style":"IPY_MODEL_9c95a9bf81274bc0ab555c42ae4a28e3","value":" 47.4M/47.4M [00:03&lt;00:00, 22.1MB/s]"}},"ddb6ca56a69342fe9e40efd6fbaab784":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6c34832ec8d34172aa6236c00d02b255":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"affb6759e2204672a1e0924ade68c094":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"b4c57b233b234d12a938d50052b7e831":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c6f20ee4a8334a79832479ffc925ae7c":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"db1bd4f563a4441b8a8a51401067469c":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9c95a9bf81274bc0ab555c42ae4a28e3":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"markdown","metadata":{"id":"AbeAB8Hokb-2"},"source":["# Setup"]},{"cell_type":"markdown","metadata":{"id":"ybu8iEZskb-3"},"source":["## Imports"]},{"cell_type":"code","execution_count":1,"metadata":{"id":"JiAEt7P6kb-3","executionInfo":{"status":"ok","timestamp":1673277824692,"user_tz":300,"elapsed":2283,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"outputs":[],"source":["import os\n","import numpy as np\n","import pandas as pd\n","from sklearn.model_selection import train_test_split\n","from sklearn.linear_model import LogisticRegression\n","from sklearn.model_selection import GridSearchCV\n","from sklearn.model_selection import cross_val_score\n","import torch\n","import random\n","import warnings\n","warnings.filterwarnings('ignore')\n","\n","from tqdm.notebook import tqdm\n","import pickle"]},{"cell_type":"markdown","metadata":{"id":"0fSMAjHpkb-4"},"source":["## Constants"]},{"cell_type":"code","execution_count":2,"metadata":{"id":"UNU4HLNZkb-5","executionInfo":{"status":"ok","timestamp":1673277824693,"user_tz":300,"elapsed":10,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"outputs":[],"source":["GCS_APP_ID = \"aqa-research\"\n","GCS_BUCKET = \"dabi-aqa-data-00\"\n","\n","FN_QUESTIONS = \"questions_01.csv\"\n","FN_CONTEXTS  = \"contexts_01.csv\"\n","\n","FN_A2_RAW = \"a2_raw.csv\"\n","FN_A2_FA  = \"a2_gs.csv\"\n","FN_A3_FA  = \"a3_gs.csv\"\n","FN_A3_MAJ = \"a3_con.csv\"\n","\n","MAX_SEQ_LEN = 128\n","\n","EPOCHS = 20\n","\n","RAND_SEED = 4243"]},{"cell_type":"markdown","metadata":{"id":"glKP3nrhkb-6"},"source":["## GCS Auth - Input Needed"]},{"cell_type":"code","execution_count":3,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":13369,"status":"ok","timestamp":1673277838054,"user":{"displayName":"Bill Power","userId":"17299628813846429758"},"user_tz":300},"id":"xwxl9-b4kb-7","outputId":"9fbda6d1-f6b0-4007-8650-5213fad59545"},"outputs":[{"output_type":"stream","name":"stdout","text":["Go to the following link in your browser:\n","\n","    https://accounts.google.com/o/oauth2/auth?response_type=code&client_id=32555940559.apps.googleusercontent.com&redirect_uri=https%3A%2F%2Fsdk.cloud.google.com%2Fauthcode.html&scope=openid+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fappengine.admin+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fsqlservice.login+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcompute+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Faccounts.reauth&state=9Kurdxvzwl1Im9vGi32Pfm1ThohAD3&prompt=consent&access_type=offline&code_challenge=3e27HdZxPw3c_KVp-9oBonAjP0xnj8xPUjKNaSuwrXA&code_challenge_method=S256\n","\n","Enter authorization code: 4/0AWgavdeVP_KloXQOdseILsGD2MWSV_HOLNDtt5KabSoQAi69LOLA2x2s5mUE1Xt9-Kp6AQ\n","\n","You are now logged in as [willpowe@gmail.com].\n","Your current project is [aqa-research].  You can change this setting by running:\n","  $ gcloud config set project PROJECT_ID\n"]}],"source":["!gcloud auth login --launch-browser"]},{"cell_type":"code","execution_count":4,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1729,"status":"ok","timestamp":1673277839763,"user":{"displayName":"Bill Power","userId":"17299628813846429758"},"user_tz":300},"id":"SEQdfjlikb-7","outputId":"814dfff1-e224-43c0-813a-f94381bbb600"},"outputs":[{"output_type":"stream","name":"stdout","text":["Updated property [core/project].\n"]}],"source":["!gcloud config set project {GCS_APP_ID}"]},{"cell_type":"code","execution_count":5,"metadata":{"id":"1x_hDs2gkb-8","executionInfo":{"status":"ok","timestamp":1673277839764,"user_tz":300,"elapsed":14,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"outputs":[],"source":["def download_file_from_gcs(src_fn, dest_fn):\n","  dest = f\"/content/{dest_fn}\"\n","  dl_command = f\"gsutil -m cp gs://{GCS_BUCKET}/{src_fn} {dest}\"\n","  os.system(dl_command)\n","\n","def upload_file_to_gcs(src_fn, dest_fn):\n","  dest_url = \"{}/{}\".format(GCS_BUCKET, dest_fn)\n","  ul_command = \"gsutil -m cp {} gs://{}\".format(src_fn, dest_url)\n","  os.system(ul_command)"]},{"cell_type":"markdown","metadata":{"id":"Df9iIZyhkb--"},"source":["## Raw Data"]},{"cell_type":"code","execution_count":6,"metadata":{"id":"YOIG4PnXkb-_","executionInfo":{"status":"ok","timestamp":1673277859012,"user_tz":300,"elapsed":19258,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"outputs":[],"source":["download_file_from_gcs(FN_QUESTIONS, FN_QUESTIONS)\n","download_file_from_gcs(FN_CONTEXTS, FN_CONTEXTS)\n","\n","download_file_from_gcs(FN_A2_RAW, FN_A2_RAW)\n","download_file_from_gcs(FN_A2_FA, FN_A2_FA)\n","download_file_from_gcs(FN_A3_FA, FN_A3_FA)\n","download_file_from_gcs(FN_A3_MAJ, FN_A3_MAJ)"]},{"cell_type":"markdown","metadata":{"id":"tzRLOi-Jkb-_"},"source":["## Transformer Setup"]},{"cell_type":"code","execution_count":7,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7723,"status":"ok","timestamp":1673277866724,"user":{"displayName":"Bill Power","userId":"17299628813846429758"},"user_tz":300},"id":"C_lWu_g_kb_A","outputId":"8bd2f2d5-7566-4376-bd08-b5ab22d4b50a"},"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: sentencepiece in /usr/local/lib/python3.8/dist-packages (0.1.97)\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: transformers in /usr/local/lib/python3.8/dist-packages (4.25.1)\n","Requirement already satisfied: requests in /usr/local/lib/python3.8/dist-packages (from transformers) (2.25.1)\n","Requirement already satisfied: pyyaml>=5.1 in /usr/local/lib/python3.8/dist-packages (from transformers) (6.0)\n","Requirement already satisfied: huggingface-hub<1.0,>=0.10.0 in /usr/local/lib/python3.8/dist-packages (from transformers) (0.11.1)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.8/dist-packages (from transformers) (2022.6.2)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.8/dist-packages (from transformers) (3.8.2)\n","Requirement already satisfied: tokenizers!=0.11.3,<0.14,>=0.11.1 in /usr/local/lib/python3.8/dist-packages (from transformers) (0.13.2)\n","Requirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.8/dist-packages (from transformers) (1.21.6)\n","Requirement already satisfied: tqdm>=4.27 in /usr/local/lib/python3.8/dist-packages (from transformers) (4.64.1)\n","Requirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.8/dist-packages (from transformers) (21.3)\n","Requirement already satisfied: typing-extensions>=3.7.4.3 in /usr/local/lib/python3.8/dist-packages (from huggingface-hub<1.0,>=0.10.0->transformers) (4.4.0)\n","Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /usr/local/lib/python3.8/dist-packages (from packaging>=20.0->transformers) (3.0.9)\n","Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.8/dist-packages (from requests->transformers) (1.24.3)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.8/dist-packages (from requests->transformers) (2.10)\n","Requirement already satisfied: chardet<5,>=3.0.2 in /usr/local/lib/python3.8/dist-packages (from requests->transformers) (4.0.0)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.8/dist-packages (from requests->transformers) (2022.12.7)\n"]}],"source":["!pip install sentencepiece\n","!pip install transformers"]},{"cell_type":"code","execution_count":8,"metadata":{"id":"VA_ZnC0dkb_A","executionInfo":{"status":"ok","timestamp":1673277870065,"user_tz":300,"elapsed":3349,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"outputs":[],"source":["import transformers as ppb"]},{"cell_type":"markdown","source":["## Random Seeds"],"metadata":{"id":"TBwBOc1LJWSS"}},{"cell_type":"code","source":["random.seed(RAND_SEED)\n","np.random.seed(RAND_SEED)\n","torch.manual_seed(RAND_SEED)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"HNrkkYVqJV62","executionInfo":{"status":"ok","timestamp":1673277870067,"user_tz":300,"elapsed":35,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}},"outputId":"39a8522f-c06f-4ee1-ae16-9831ce20b436"},"execution_count":9,"outputs":[{"output_type":"execute_result","data":{"text/plain":["<torch._C.Generator at 0x7f14c7e49e90>"]},"metadata":{},"execution_count":9}]},{"cell_type":"markdown","metadata":{"id":"kNQBRgQkkb_B"},"source":["## Transformer Init\n","\n"]},{"cell_type":"code","source":["# # # For ALBERT\n","# tokenizer  = ppb.AlbertTokenizer.from_pretrained(\"albert-base-v2\")\n","# bert_model = ppb.AlbertForPreTraining.from_pretrained(\"albert-base-v2\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":168,"referenced_widgets":["a702fe9e514b4a34849d2ecd86256b02","55eb18ed2ea24f62b68d5f9301b23fca","6220c742f61a4aacba6b9e01e76f3386","ed5b2591b62d4684aa4c3dfebde3a45c","c01f136eb82549f0a813fb0ab5ae0621","942c719d0b6f4bb28fefc05624ee9b73","6bb79bc967974278973b51cd7c52b7a2","49e88acc741a45598cbc81ebfbacfae2","9af8ecc214ff462e9dfe2d057eaf1c0f","cb77075daea9465288fe5d7d155fa649","51026f57142449749ad2ccaebf086c7e","bc0deef2403a4b3d80509c2170b87753","503b1719d99a48af8ff5b07cad1d3635","e5781b39167e4c1e934866dad70c61d5","1611958956424f35a527697fd0c71220","261e0fd22d6f427ba39f8b487ca7a3c3","738a5288351b4d539ab9c542c0545a27","6bcde7793e5745de8fe1932a8e20d1c9","77a8fd5be9f94b48a7a593979703448d","b2def5eadf284c6799ccd4ee286e0d3b","c112a76518874d5289f81904945c2cd2","46695f2267704473aeff50ba07e196fe","43dd050aa90d45549132700e255d5962","93cc81dd208640ea95a2f8c993561c80","c5d8684bbb454a7597845ca08e6d5a50","8ee21c72ee62400eaa743458f568b51a","ddb6ca56a69342fe9e40efd6fbaab784","6c34832ec8d34172aa6236c00d02b255","affb6759e2204672a1e0924ade68c094","b4c57b233b234d12a938d50052b7e831","c6f20ee4a8334a79832479ffc925ae7c","db1bd4f563a4441b8a8a51401067469c","9c95a9bf81274bc0ab555c42ae4a28e3"]},"id":"TLdlx2LkHm-S","executionInfo":{"status":"ok","timestamp":1673278121856,"user_tz":300,"elapsed":13030,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}},"outputId":"e3afbdf1-798a-44d8-c8a3-03d73eea9be0"},"execution_count":12,"outputs":[{"output_type":"display_data","data":{"text/plain":["Downloading:   0%|          | 0.00/760k [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"a702fe9e514b4a34849d2ecd86256b02"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading:   0%|          | 0.00/684 [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"bc0deef2403a4b3d80509c2170b87753"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading:   0%|          | 0.00/47.4M [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"43dd050aa90d45549132700e255d5962"}},"metadata":{}},{"output_type":"stream","name":"stderr","text":["Some weights of AlbertForPreTraining were not initialized from the model checkpoint at albert-base-v2 and are newly initialized: ['sop_classifier.classifier.bias', 'sop_classifier.classifier.weight']\n","You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.\n"]}]},{"cell_type":"code","execution_count":26,"metadata":{"executionInfo":{"elapsed":2042,"status":"ok","timestamp":1673278386281,"user":{"displayName":"Bill Power","userId":"17299628813846429758"},"user_tz":300},"id":"wrotnPAHkb_C","colab":{"base_uri":"https://localhost:8080/"},"outputId":"bf11f4e2-0fc1-481d-d74a-c1e780d95f68"},"outputs":[{"output_type":"stream","name":"stderr","text":["Some weights of the model checkpoint at albert-base-v2 were not used when initializing AlbertModel: ['predictions.bias', 'predictions.dense.bias', 'predictions.decoder.bias', 'predictions.LayerNorm.weight', 'predictions.dense.weight', 'predictions.decoder.weight', 'predictions.LayerNorm.bias']\n","- This IS expected if you are initializing AlbertModel from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n","- This IS NOT expected if you are initializing AlbertModel from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\n"]}],"source":["model_class, tokenizer_class, pretrained_weights = (ppb.AlbertModel, ppb.AlbertTokenizer, 'albert-base-v2')\n","\n","# # For DistilBERT:\n","# model_class, tokenizer_class, pretrained_weights = (ppb.DistilBertModel, ppb.DistilBertTokenizer, 'distilbert-base-uncased')\n","\n","# # For Full BERT\n","# #model_class, tokenizer_class, pretrained_weights = (ppb.BertModel, ppb.BertTokenizer, 'bert-base-uncased')\n","\n","# # Load pretrained model/tokenizer\n","tokenizer = tokenizer_class.from_pretrained(pretrained_weights, truncate=True,)\n","bert_model = model_class.from_pretrained(pretrained_weights)"]},{"cell_type":"markdown","metadata":{"id":"YEniTxLUPL-K"},"source":["# Content Embeddings"]},{"cell_type":"markdown","source":["## Load Dataframes"],"metadata":{"id":"zUUz0lb2yLAg"}},{"cell_type":"code","execution_count":38,"metadata":{"id":"WuLRs3tXkb_C","executionInfo":{"status":"ok","timestamp":1673278992256,"user_tz":300,"elapsed":3,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"outputs":[],"source":["questions = pd.read_csv(FN_QUESTIONS)\n","contexts  = pd.read_csv(FN_CONTEXTS)\n","\n","# content_a2_raw = pd.read_csv(FN_A2_RAW)\n","# content_a2_fa  = pd.read_csv(FN_A2_FA)\n","content_a3_fa  = pd.read_csv(FN_A3_FA)\n","content_a3_maj = pd.read_csv(FN_A3_MAJ)\n","\n","content_a3_majplus = pd.concat([content_a3_fa, content_a3_maj])"]},{"cell_type":"markdown","metadata":{"id":"LOr21JIPpm8I"},"source":["## Sequence Padding Method"]},{"cell_type":"code","execution_count":39,"metadata":{"id":"C7i_zEHIkb_D","executionInfo":{"status":"ok","timestamp":1673278992681,"user_tz":300,"elapsed":15,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"outputs":[],"source":["# A side effect of this is all the DF's passed in will have a 'tokens' column \n","# added to them. \n","def prepare_padded_sequences(df_in, text_col):\n","  # Tokenize\n","  df_in['tokens'] = df_in[text_col].apply(lambda x: tokenizer.encode(x,\n","                                                                     max_length=MAX_SEQ_LEN,\n","                                                                     truncation=True,\n","                                                                     add_special_tokens=True))\n","  df_in['num_tokens'] = df_in['tokens'].apply(lambda x: len(x))\n","  max_len = df_in['num_tokens'].max()\n","  return np.array([i + [0]*(max_len-len(i)) for i in df_in['tokens'].values])"]},{"cell_type":"markdown","source":["## Question/Context Embedding Dicts"],"metadata":{"id":"noOpZRP8yXpr"}},{"cell_type":"code","source":["padded_questions = torch.tensor(prepare_padded_sequences(questions, 'question_text'))\n","padded_contexts  = torch.tensor(prepare_padded_sequences(contexts, 'context_text'))\n","\n","mask_questions =  torch.tensor(np.where(padded_questions != 0, 1, 0))\n","mask_contexts  =  torch.tensor(np.where(padded_contexts != 0, 1, 0))\n","\n","with torch.no_grad():\n","    lhs_questions = bert_model(padded_questions, attention_mask=mask_questions).last_hidden_state\n","    lhs_contexts  = bert_model(padded_contexts, attention_mask=mask_contexts).last_hidden_state\n","\n","emb_questions = lhs_questions[:,0,:]\n","emb_contexts  = lhs_contexts[:,0,:]\n","\n","questions['embedding'] = list(emb_questions)\n","contexts['embedding']  = list(emb_contexts)"],"metadata":{"id":"-kJTjIk807QY","executionInfo":{"status":"ok","timestamp":1673278993643,"user_tz":300,"elapsed":973,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"execution_count":40,"outputs":[]},{"cell_type":"code","execution_count":41,"metadata":{"id":"35ukWIxGuq_t","executionInfo":{"status":"ok","timestamp":1673278993645,"user_tz":300,"elapsed":8,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"2c504e4b-dee0-4a61-8fc5-e03ec6fdf67b"},"outputs":[{"output_type":"stream","name":"stdout","text":["q and ctx maps built\n"]}],"source":["map_q_emb = dict()\n","def build_q_map(row):\n","  global map_q_emb\n","  map_q_emb[row['question_id']] = row['embedding']\n","\n","map_ctx_emb = dict()\n","\n","def build_ctx_map(row):\n","  global map_ctx_emb\n","  map_ctx_emb[row['context_id']] = row['embedding']\n","\n","\n","questions.apply(build_q_map, axis=1)\n","contexts.apply(build_ctx_map, axis=1)\n","print(\"q and ctx maps built\")"]},{"cell_type":"code","source":["FN_Q_MAP = \"question_emb_map_00.p\"\n","FN_CTX_MAP = \"context_emb_map_00.p\"\n","\n","with open(FN_Q_MAP, 'wb') as f:\n","  pickle.dump(map_q_emb, f)\n","\n","with open(FN_CTX_MAP, 'wb') as f:\n","  pickle.dump(map_ctx_emb, f)"],"metadata":{"id":"Xd-8qpOqYTYM","executionInfo":{"status":"ok","timestamp":1673278993645,"user_tz":300,"elapsed":6,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"execution_count":42,"outputs":[]},{"cell_type":"code","source":["upload_file_to_gcs(FN_Q_MAP, FN_Q_MAP)\n","upload_file_to_gcs(FN_CTX_MAP, FN_CTX_MAP)"],"metadata":{"id":"EUClAjgXgUv3","executionInfo":{"status":"ok","timestamp":1673279000790,"user_tz":300,"elapsed":7149,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"execution_count":43,"outputs":[]},{"cell_type":"code","source":["print(len(content_a3_majplus))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"v3v_WwxKi76G","executionInfo":{"status":"ok","timestamp":1673279000792,"user_tz":300,"elapsed":34,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}},"outputId":"d20a6904-6bbb-40cf-8d1e-ecba809a5e5d"},"execution_count":44,"outputs":[{"output_type":"stream","name":"stdout","text":["2138\n"]}]},{"cell_type":"markdown","source":["## Embed Content"],"metadata":{"id":"5qE6Ark4YVSD"}},{"cell_type":"code","source":["def add_embeddings(df, content_col):\n","  padded_sequences = torch.tensor(prepare_padded_sequences(df, content_col))\n","  mask =  torch.tensor(np.where(padded_sequences != 0, 1, 0))\n","\n","  with torch.no_grad():\n","    lhs = bert_model(padded_sequences, attention_mask=mask).last_hidden_state\n","\n","  df['content-embedding'] = list(lhs[:,0,:])"],"metadata":{"id":"G8V05DaOY0js","executionInfo":{"status":"ok","timestamp":1673279000793,"user_tz":300,"elapsed":26,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"execution_count":45,"outputs":[]},{"cell_type":"code","source":["def chunk_embed_save(df_full, content_col, fn_stub, chunk_size=500, upload=True):\n","  num_chunks = int(len(df_full)/chunk_size)\n","  for i in range(num_chunks):\n","    print(f\"chunk {i+1} of {num_chunks} running\")\n","    df_i = df_full.iloc[i:i+chunk_size,:]\n","    add_embeddings(df_i, content_col)\n","    fn_i = f\"{fn_stub}_{i+1}_of_{num_chunks}.p\"\n","    with open(fn_i, \"wb\") as f:\n","      pickle.dump(df_i, f)\n","    \n","    if upload:\n","      upload_file_to_gcs(fn_i, fn_i)"],"metadata":{"id":"WZvIfXttiynU","executionInfo":{"status":"ok","timestamp":1673279000794,"user_tz":300,"elapsed":23,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"execution_count":46,"outputs":[]},{"cell_type":"code","source":["chunk_embed_save(content_a3_majplus, 'content_text', \"df_a3_majplus_v00\", chunk_size=3000)"],"metadata":{"id":"Dab7SvElYZAP","executionInfo":{"status":"ok","timestamp":1673279000794,"user_tz":300,"elapsed":21,"user":{"displayName":"Bill Power","userId":"17299628813846429758"}}},"execution_count":47,"outputs":[]}]}